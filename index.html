<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>SoundCloud Party + Queue</title>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script src="https://w.soundcloud.com/player/api.js"></script>
    <style>
        body { background: #121212; color: white; font-family: 'Segoe UI', sans-serif; display: flex; height: 100vh; margin: 0; overflow: hidden; }
        
        /* –õ–µ–≤–∞—è —á–∞—Å—Ç—å: –ü–ª–µ–µ—Ä */
        .main-content { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; border-right: 1px solid #333; }
        
        /* –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: –û—á–µ—Ä–µ–¥—å */
        .sidebar { width: 350px; background: #181818; display: flex; flex-direction: column; padding: 20px; }
        
        .player-card { background: #1e1e1e; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        .queue-list { flex: 1; overflow-y: auto; margin-top: 20px; text-align: left; }
        .queue-item { background: #282828; padding: 10px; border-radius: 8px; margin-bottom: 10px; font-size: 14px; border: 1px solid #383838; }
        
        .input-group { display: flex; flex-direction: column; gap: 10px; width: 100%; }
        input { background: #2b2b2b; border: 1px solid #444; color: white; padding: 12px; border-radius: 8px; outline: none; }
        button { background: #f50; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; color: white; }
        button.add-btn { background: #333; margin-top: 5px; }
        
        h2 { color: #f50; margin-top: 0; }
        #status { font-size: 12px; color: #777; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="main-content">
        <div class="player-card">
            <h2>üü† –°–µ–π—á–∞—Å –∏–≥—Ä–∞–µ—Ç</h2>
            <iframe id="sc-player" width="450" height="166" scrolling="no" frameborder="no" allow="autoplay" 
                src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/1148784325&color=%23ff5500&auto_play=false">
            </iframe>
            <div id="status">üì° –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</div>
        </div>
    </div>

    <div class="sidebar">
        <h2>üìú –û—á–µ—Ä–µ–¥—å</h2>
        <div class="input-group">
            <input type="text" id="trackUrl" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ —Ç—Ä–µ–∫ SoundCloud">
            <button onclick="addToQueue()">–î–æ–±–∞–≤–∏—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å</button>
        </div>
        
        <div class="queue-list" id="queue-container">
            </div>
        
        <button class="add-btn" onclick="nextTrack()">–°–ª–µ–¥—É—é—â–∏–π —Ç—Ä–µ–∫ ‚è≠</button>
    </div>

    <script>
        const socket = io('http://localhost:3000');
        const widget = SC.Widget(document.getElementById('sc-player'));
        let queue = [];

        socket.on('connect', () => {
            document.getElementById('status').innerText = "üü¢ –°–µ—Ä–≤–µ—Ä –æ–Ω–ª–∞–π–Ω";
        });

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä
        function addToQueue() {
            const url = document.getElementById('trackUrl').value.trim();
            if (url) {
                socket.emit('add_to_queue', url);
                document.getElementById('trackUrl').value = "";
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –æ—á–µ—Ä–µ–¥–∏ —É –≤—Å–µ—Ö
        socket.on('update_queue', (serverQueue) => {
            queue = serverQueue;
            const container = document.getElementById('queue-container');
            container.innerHTML = "";
            
            queue.forEach((url, index) => {
                const item = document.createElement('div');
                item.className = 'queue-item';
                item.innerText = `${index + 1}. ${url.split('/').pop()}`; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω–µ—Ü —Å—Å—ã–ª–∫–∏ –∫–∞–∫ –Ω–∞–∑–≤–∞–Ω–∏–µ
                container.appendChild(item);
            });
        });

        // –ö–æ–º–∞–Ω–¥–∞ –Ω–∞ –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ç—Ä–µ–∫–∞
        function nextTrack() {
            socket.emit('request_next');
        }

        socket.on('play_track', (url) => {
            widget.load(url, { auto_play: true, color: "#ff5500" });
        });

        // –ö–æ–≥–¥–∞ —Ç—Ä–µ–∫ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è —Å–∞–º ‚Äî –ø—Ä–æ—Å–∏–º —Å–ª–µ–¥—É—é—â–∏–π
        widget.bind(SC.Widget.Events.FINISH, () => {
            nextTrack();
        });
    </script>
</body>
</html>
